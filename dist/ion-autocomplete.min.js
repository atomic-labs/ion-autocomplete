/*
 * ion-autocomplete 0.2.3
 * Copyright 2015 Danny Povolotski 
 * Copyright modifications 2015 Guy Brand 
 * https://github.com/guylabs/ion-autocomplete
 */
!function(){"use strict";angular.module("ion-autocomplete",[]).directive("ionAutocomplete",["$ionicTemplateLoader","$ionicScrollDelegate","$rootScope","$document","$q","$parse","$ionicPlatform",function(a,b,c,d,e,f,g){return{require:"?ngModel",restrict:"A",scope:{model:"=ngModel",placeholder:"@",cancelLabel:"@",selectItemsLabel:"@",selectedItemsLabel:"@",templateUrl:"@",templateData:"=",itemsMethod:"&",itemsMethodValueKey:"@",itemValueKey:"@",itemViewValueKey:"@",multipleSelect:"@",itemsClickedMethod:"&",itemsRemovedMethod:"&",componentId:"@",modelToItemMethod:"&",loadingIcon:"@"},link:function(c,h,i,j){if(j){c.placeholder=c.placeholder?c.placeholder:"Click to enter a value...",c.cancelLabel=c.cancelLabel?c.cancelLabel:"true"===c.multipleSelect?"Done":"Cancel",c.selectItemsLabel=c.selectItemsLabel?c.selectItemsLabel:"Select an item...",c.selectedItemsLabel=c.selectedItemsLabel?c.selectedItemsLabel:"Selected items:",c.templateUrl=c.templateUrl?c.templateUrl:"",c.loadingIcon=c.loadingIcon?c.loadingIcon:"",c.showLoadingIcon=!1,c.items=[],c.selectedItems=[],c.searchQuery=void 0,c.getItemValue=function(a,b){if(angular.isArray(a)){var c=[];return angular.forEach(a,function(d){b&&angular.isObject(a)?c.push(f(b)(d)):c.push(d)}),c}return b&&angular.isObject(a)?f(b)(a):a};var k=['<div class="ion-autocomplete-container modal">','<div class="bar bar-header item-input-inset">','<label class="item-input-wrapper">','<i class="icon ion-search placeholder-icon"></i>','<input type="search" class="ion-autocomplete-search" ng-model="searchQuery" placeholder="{{placeholder}}"/>',"</label>",'<div class="ion-autocomplete-loading-icon" ng-if="showLoadingIcon && loadingIcon"><ion-spinner icon="{{loadingIcon}}"></ion-spinner></div>','<button class="ion-autocomplete-cancel button button-clear">{{cancelLabel}}</button>',"</div>",'<ion-content class="has-header has-header">',"<ion-list>",'<ion-item class="item-divider" ng-show="selectedItems.length > 0">{{selectedItemsLabel}}</ion-item>','<ion-item ng-repeat="selectedItem in selectedItems track by $index" type="item-text-wrap" class="item-icon-left item-icon-right">','<i class="icon ion-checkmark"></i>',"{{getItemValue(selectedItem, itemViewValueKey)}}",'<i class="icon ion-trash-a" style="cursor:pointer" ng-click="removeItem($index)"></i>',"</ion-item>",'<ion-item class="item-divider" ng-show="items.length > 0">{{selectItemsLabel}}</ion-item>','<ion-item collection-repeat="item in items" item-height="55" item-width="100%" type="item-text-wrap" ng-click="selectItem(item)">',"{{getItemValue(item, itemViewValueKey)}}","</ion-item>","</ion-list>","</ion-content>","</div>"].join("");a.compile({templateUrl:c.templateUrl,template:k,scope:c,appendTo:d[0].body}).then(function(a){var d=angular.element(a.element.find("input"));a.scope.selectItem=function(b){a.scope.items=[],a.scope.searchQuery=void 0,"true"===a.scope.multipleSelect?(o(a.scope.selectedItems,a.scope.itemValueKey,c.getItemValue(b,c.itemValueKey))||(a.scope.selectedItems=a.scope.selectedItems.concat([b])),j.$setViewValue(a.scope.selectedItems),j.$render()):(j.$setViewValue(b),j.$render(),i()),angular.isFunction(a.scope.itemsClickedMethod)&&a.scope.itemsClickedMethod({callback:{item:b,selectedItems:a.scope.selectedItems.slice(),componentId:a.scope.componentId}})},a.scope.removeItem=function(b){var c=a.scope.selectedItems.splice(b,1)[0];a.scope.selectedItems=a.scope.selectedItems.slice(),j.$setViewValue(a.scope.selectedItems),j.$render(),angular.isFunction(a.scope.itemsRemovedMethod)&&a.scope.itemsRemovedMethod({callback:{item:c,selectedItems:a.scope.selectedItems.slice(),componentId:a.scope.componentId}})},a.scope.$watch("searchQuery",function(c){if(void 0!==c&&(""==c&&(a.scope.items=[]),angular.isFunction(a.scope.itemsMethod))){a.scope.showLoadingIcon=!0;var d={query:c};a.scope.componentId&&(d={query:c,componentId:a.scope.componentId});var f=e.when(a.scope.itemsMethod(d));f.then(function(c){c&&c.data&&(c=c.data),a.scope.items=a.scope.getItemValue(c,a.scope.itemsMethodValueKey),b.resize(),a.scope.showLoadingIcon=!1},function(a){return e.reject(a)})}});var f=function(){a.element.css("display","block"),c.$deregisterBackButton=g.registerBackButtonAction(function(){i()},300)},i=function(){a.element.css("display","none"),c.$deregisterBackButton&&c.$deregisterBackButton()},k={moved:!1,startX:0,startY:0},l=function(a){k.moved=!1,"undefined"!=typeof a.originalEvent&&(a=a.originalEvent),k.startX=a.touches[0].clientX,k.startY=a.touches[0].clientY},m=function(a){"undefined"!=typeof a.originalEvent&&(a=a.originalEvent),(Math.abs(a.touches[0].clientX-k.startX)>10||Math.abs(a.touches[0].clientY-k.startY)>10)&&(k.moved=!0)},n=function(a){k.moved||(a.preventDefault(),a.stopPropagation(),f(),d.length>0&&(d[0].focus(),setTimeout(function(){d[0].focus()},0)),b.resize())},o=function(a,b,d){for(var e=0;e<a.length;e++)if(c.getItemValue(a[e],b)===d)return!0;return!1},p=function(b){var c=e.when(a.scope.modelToItemMethod({modelValue:b}));c.then(function(b){a.scope.selectItem(b)},function(a){return e.reject(a)})};h.bind("touchstart",l),h.bind("touchmove",m),h.bind("touchend click focus",n),a.element.find("button").bind("click",function(b){a.scope.searchQuery=void 0,i()}),a.scope.model&&angular.isFunction(a.scope.modelToItemMethod)&&("true"===a.scope.multipleSelect&&angular.isArray(a.scope.model)?angular.forEach(a.scope.model,function(a){p(a)}):p(a.scope.model))}),j.$render=function(){h.val(c.getItemValue(j.$viewValue,c.itemViewValueKey))},j.$formatters.push(function(a){var b=c.getItemValue(a,c.itemViewValueKey);return void 0==b?"":b}),j.$parsers.push(function(a){return c.getItemValue(a,c.itemValueKey)})}}}}]).directive("ionAutocomplete",function(){return{require:"?ngModel",restrict:"E",template:'<input ion-autocomplete type="text" readonly="readonly" class="ion-autocomplete" autocomplete="off" />',replace:!0}})}();